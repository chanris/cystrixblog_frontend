import{l as oe,u as ne,o as ie,r as l,w as U,E as p,b as r,q as de,c as n,d as z,f as s,k as m,h as d,e as c,s as b,g as v,F as S,i as ue,p as re,j as ce}from"./index-svAZxImQ.js";import{e as pe,f as me}from"./article-QCYIFHnI.js";import{a as ve,b as ge,c as fe}from"./category-ikiEN8KW.js";import{_ as _e,b as ye,c as he,d as xe,a as Ve}from"./tag-oFrp3rdu.js";import{_ as ke}from"./_plugin-vue_export-helper-x3n3nnut.js";import"./request-Kvlrod8x.js";const w=y=>(re("data-v-2076b3de"),y=y(),ce(),y),Ie={class:"container"},be={class:"top"},we={style:{display:"flex","align-items":"center"}},Ce=w(()=>s("span",{style:{width:"37px"}},"标题：",-1)),Te={style:{display:"flex","align-items":"center"}},Ae=w(()=>s("span",{style:{width:"37px"}},"摘要：",-1)),Re={style:{display:"flex","align-items":"center"}},Le=w(()=>s("span",{style:{width:"45px"}},"标签：",-1)),Be=w(()=>s("span",null,"分类：",-1)),Ue={class:"content"},ze={__name:"detail",setup(y){const u=oe(),F=ne();ie(()=>{u.params.id?(j({id:u.params.id}),G({id:1}),J()):F.push("/admin")});const h=l(!1),f=l(!0),x=l(!1),o=l({content:"",digest:"",title:""}),j=t=>{x.value=!0,pe(t).then(({result:e})=>{o.value=e}).finally(()=>{x.value=!1})},q=t=>{me(t).then(e=>{e.code===200&&(p({type:"success",message:"更新成功"}),f.value=!0,h.value=!1)})},O=(t,e,i)=>{console.log(i),e({url:"http://47.109.110.189:8080/download/img",desc:""})},P=()=>{q(o.value)};U(()=>o.value.title,(t,e)=>{t&&e!==""&&(f.value=!1)}),U(()=>o.value.digest,(t,e)=>{t&&e!==""&&(f.value=!1)});const C=l(!1),V=l(""),D=l([]),$=t=>{ge(t).then(e=>{e.code===200&&(V.value=""+e.result.id)})},G=t=>{C.value=!0,ve(t).then(({result:e})=>{D.value.push(e)}).finally(()=>{C.value=!1,$({id:parseInt(u.params.id)})})},H=t=>{fe(t).then(e=>{e.code===200&&p({type:"success",message:"更新成功"})})};U(()=>V.value,(t,e)=>{t&&e!==""&&H({articleId:parseInt(u.params.id),categoryId:parseInt(t)})});const T=l(!1),A=l(!1),R=l([]),E=l(new Set),k=l([]),g=l(""),L=l([]),J=()=>{T.value=!0,_e().then(({result:t})=>{L.value=t,M({id:u.params.id})}).finally(()=>{T.value=!1})},M=t=>{ye(t).then(e=>{if(e.code===200)for(let i of e.result)R.value.push(i.id),E.value.add(i.id);else p({type:"error",message:e.msg})})},K=()=>{if(g.value){let t=g.value;Ve({name:g.value}).then(e=>{L.value.push({id:e.result,name:t}),p({type:"success",message:"添加成功"})}),N()}else p({type:"error",message:"标签名称不能为空"})},N=()=>{g.value="",A.value=!1},Q=t=>{let e=t.filter(i=>!E.value.has(i));e.length&&(k.value=e)},W=()=>{if(k.value.length){let t=[];k.value.forEach(e=>{t.push({tagId:e,articleId:parseInt(u.params.id)})}),Z(t)}},X=t=>{Y({articleId:parseInt(u.params.id),tagId:t})},Y=t=>{he(t).then(e=>{e.code===200&&p({type:"success",message:"删除成功"})})},Z=t=>{xe(t).then(e=>{e.code===200&&(M({id:u.params.id}),p({type:"success",message:"添加成功"}))}).finally(()=>{k.value=[]})};return(t,e)=>{const i=r("el-tag"),B=r("el-input"),ee=r("el-option"),_=r("el-button"),te=r("el-select"),ae=r("el-tree-select"),le=r("v-md-editor"),se=r("v-md-preview"),I=de("loading");return n(),z("div",Ie,[s("div",be,[s("div",null,[f.value?(n(),m(i,{key:0,type:"success",effect:"dark",round:""},{default:d(()=>[v("已发布")]),_:1})):(n(),m(i,{key:1,type:"warning",effect:"dark",round:""},{default:d(()=>[v("未发布")]),_:1}))]),s("div",we,[Ce,c(B,{modelValue:o.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.title=a),modelModifiers:{trim:!0},clearable:"",type:"input",placeholder:"文章标签",maxlength:"30",style:{width:"260px"}},null,8,["modelValue"])]),s("div",Te,[Ae,c(B,{modelValue:o.value.digest,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.digest=a),modelModifiers:{trim:!0},autosize:{minRows:1,maxRows:4},resize:"none",clearable:"",type:"textarea",placeholder:"文章摘要（限两百字）",maxlength:"200",style:{width:"300px"}},null,8,["modelValue"])]),s("div",Re,[Le,b((n(),m(te,{modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=a=>R.value=a),onChange:Q,onRemoveTag:X,onBlur:W,multiple:"","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":2,placeholder:"请选择标签",style:{width:"240px"}},{footer:d(()=>[A.value?(n(),z(S,{key:1},[c(B,{style:{"margin-bottom":"10px"},modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),placeholder:"请输入标签名称",size:"small"},null,8,["modelValue"]),c(_,{type:"primary",size:"small",onClick:K},{default:d(()=>[v("添加")]),_:1}),c(_,{size:"small",onClick:N},{default:d(()=>[v("取消")]),_:1})],64)):(n(),m(_,{key:0,text:"",bg:"",size:"small",onClick:e[2]||(e[2]=a=>A.value=!0)},{default:d(()=>[v(" 新建标签 ")]),_:1}))]),default:d(()=>[(n(!0),z(S,null,ue(L.value,a=>(n(),m(ee,{key:a.value,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])),[[I,T.value]])]),s("div",null,[Be,b(c(ae,{placeholder:"请选择分类",modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=a=>V.value=a),data:D.value,"check-strictly":"","render-after-expand":!1,"show-checkbox":""},null,8,["modelValue","data"]),[[I,C.value]])]),s("div",null,[c(_,{plain:"",color:"#626aef",onClick:e[6]||(e[6]=()=>{h.value=!h.value,f.value=!1})},{default:d(()=>[v("编辑")]),_:1}),c(_,{type:"primary",onClick:P},{default:d(()=>[v("保存")]),_:1})])]),s("div",Ue,[h.value?b((n(),m(le,{key:0,"disabled-menus":[],modelValue:o.value.content,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.content=a),onUploadImage:O,height:"790px"},null,8,["modelValue"])),[[I,x.value]]):b((n(),m(se,{key:1,text:o.value.content,height:"790px"},null,8,["text"])),[[I,x.value]])])])}}},je=ke(ze,[["__scopeId","data-v-2076b3de"]]);export{je as default};
